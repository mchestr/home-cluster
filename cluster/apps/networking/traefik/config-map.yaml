apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config-map
data:
  middleware.yml: |
    # Replace `nord` with your theme of choice!
    {{ $theme := "plex" }}
    http:
      middlewares:
        #  Add any suppported base apps you would like to include in your auto generated middle set. "sonarr" and "radarr are the examples here.
        {{ range $index, $app := list "sonarr" "radarr" "lidarr" "readarr" "prowlarr" "bazarr" "overseerr" "tautulli" "nzbget" "qbittorrent" "bitwarden" }}
        {{ $app }}-theme-css:
          plugin:
            rewritebody:
              rewrites:
                - regex: </head>
                  replacement: <link rel="stylesheet" type="text/css" href="https://theme-park.${CLUSTER_DOMAIN}/css/base/{{ $app }}/{{ $theme }}.css"></head>

        # Wrap CSS and theme headers in single middleware for ease of use
        {{ $app }}-theme:
          chain:
            middlewares:
              - theme-headers
              - {{ $app }}-theme-css
        {{ end }}

        #  4k addon section
        {{ range $index, $app := list "radarr" }}
        {{ $app }}-4k-theme-css:
          plugin:
            rewritebody:
              rewrites:
                - regex: </head>
                  replacement: <link rel="stylesheet" type="text/css" href="https://theme-park.${CLUSTER_DOMAIN}/css/base/{{ $app }}/{{ $theme }}.css"><link rel="stylesheet" type="text/css" href="https://theme-park.${CLUSTER_DOMAIN}/css/addons/{{ $app }}/{{ $app }}-4k-logo/{{ $app }}-4k-logo.css"></head>

        # Wrap CSS and theme headers in single middleware for ease of use
        {{ $app }}-4k-theme:
          chain:
            middlewares:
              - theme-headers
              - {{ $app }}-4k-theme-css
        {{ end }}

  headers.yml: |
    # This is an example of how to set request headers to prioritize supported encoding.
    http:
      middlewares:
        theme-headers:
          headers:
            customRequestHeaders:
              accept-encoding: gzip;1.0,deflate;0.5,identity;0.1
        qbittorrent-headers:
          headers:
            content-security-policy: default-src 'self'; style-src 'self' 'unsafe-inline' theme-park.${CLUSTER_DOMAIN} raw.githubusercontent.com use.fontawesome.com; img-src 'self' theme-park.${CLUSTER_DOMAIN} raw.githubusercontent.com data:; script-src 'self' 'unsafe-inline'; object-src 'none'; form-action 'self'; frame-ancestors 'self'; font-src use.fontawesome.com;
