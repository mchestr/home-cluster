---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: snapscheduler-schedules
  namespace: volsync
spec:
  interval: 15m
  chart:
    spec:
      chart: raw
      version: v0.3.1
      sourceRef:
        kind: HelmRepository
        name: dysnix-charts
        namespace: flux-system
  install:
    createNamespace: true
    remediation:
      retries: 5
  upgrade:
    remediation:
      retries: 5
  dependsOn:
    - name: rook-ceph
      namespace: rook-ceph-cluster
    - name: volsync
      namespace: snapscheduler
  values:
    resources:
      - apiVersion: snapscheduler.backube/v1
        kind: SnapshotSchedule
        metadata:
          name: main
          namespace: default
        spec:
          disabled: false
          claimSelector:
            matchLabels:
              snapshot.home.arpa/enabled: "true"
          retention:
            expires: 48h
          schedule: "@daily"
          snapshotTemplate:
            snapshotClassName: csi-ceph-blockpool
