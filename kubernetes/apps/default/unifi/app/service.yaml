---
apiVersion: v1
kind: Service
metadata:
  annotations:
    meta.helm.sh/release-name: unifi
    meta.helm.sh/release-namespace: default
    external-dns.alpha.kubernetes.io/hostname: unifi-mgmt.chestr.dev
    # We can use cilium once supported
    # https://github.com/cilium/cilium/issues/21776
    metallb.universe.tf/allow-shared-ip: unifi
  name: unifi-mgmt
  namespace: default
spec:
  type: LoadBalancer
  # app-template doesn't support loadBalancerClass as it was introduced in k8s 1.24
  # Define a custom service here for the unifi port.
  loadBalancerClass: metallb
  externalTrafficPolicy: Local
  loadBalancerIP: 192.168.1.230
  selector:
    app.kubernetes.io/component: main
    app.kubernetes.io/instance: unifi
    app.kubernetes.io/name: unifi
  ports:
    - name: controller
      enabled: true
      port: 8080
      protocol: TCP
    - name: speedtest
      enabled: true
      port: 6789
      protocol: TCP
    - name: stun
      enabled: true
      port: 3478
      protocol: UDP
    - name: syslog
      enabled: true
      port: 5514
      protocol: UDP
    - name: discovery
      enabled: true
      port: 10001
      protocol: UDP
