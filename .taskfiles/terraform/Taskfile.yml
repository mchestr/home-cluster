---
version: "3"

env:
  ONEPASSWORD_ACCOUNT_ID:
    sh: op account list --format json | jq -r '.[].user_uuid'

tasks:

  cf:init:
    desc: Initialize terraform dependencies
    dir: terraform/cloudflare
    cmds:
      - terraform init {{.CLI_ARGS}}

  cf:plan:
    desc: Show the changes terraform will make
    dir: terraform/cloudflare
    cmds:
      - terraform plan {{.CLI_ARGS}} -var "onepassword_account_id=${ONEPASSWORD_ACCOUNT_ID}"

  cf:apply:
    desc: Apply the changes to Cloudflare
    dir: terraform/cloudflare
    cmds:
      - terraform apply {{.CLI_ARGS}} -var "onepassword_account_id=${ONEPASSWORD_ACCOUNT_ID}"
